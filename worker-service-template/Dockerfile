FROM maven:3.5-jdk-8 AS build-env

ARG BUILD_NUMBER=local

ARG BUILD_TIMESTAMP=

ARG GIT_COMMIT_SHORT=

ARG GIT_AUTHOR_NAME=

WORKDIR /build

COPY . .

RUN mvn -Pdocker clean package


FROM openjdk:8-jre-alpine

ENV SPRING_BOOT_APP_JAVA_OPTS -Xms256m -Xmx256m

ENV SPRING_BOOT_APP service.jar
ENV SPRING_BOOT_APP_PATH /opt/$SPRING_BOOT_APP

COPY --from=build-env /build/target/$SPRING_BOOT_APP $SPRING_BOOT_APP_PATH

EXPOSE 8282

VOLUME /temp
VOLUME /logs

ENTRYPOINT java $SPRING_BOOT_APP_JAVA_OPTS -jar $SPRING_BOOT_APP_PATH $SPRING_BOOT_APP_OPTS
